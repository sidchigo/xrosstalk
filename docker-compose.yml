services:
    frontend:
        build:
            context: ./apps/frontend
        ports:
            - "${FRONTEND_PORT}:80"
        depends_on:
            - server-comet
            - server-orbit
        restart: unless-stopped
        networks:
            - xrosstalk-net

    server-comet:
        build:
            context: ./apps/server-comet
        ports:
            - "${COMET_PORT}:5000"
        environment:
            - REDIS_HOST=redis
            - RABBITMQ_URL=amqp://guest:guest@rabbitmq:5672/
        depends_on:
            - redis
            - rabbitmq
        restart: unless-stopped
        networks:
            - xrosstalk-net

    server-orbit:
        build:
            context: ./apps/server-orbit
        ports:
            - "${ORBIT_PORT}:5001"
        environment:
            - REDIS_HOST=redis
            - RABBITMQ_URL=amqp://guest:guest@rabbitmq:5672/
        depends_on:
            - redis
            - rabbitmq
        restart: unless-stopped
        networks:
            - xrosstalk-net

    redis:
        image: redis:7
        ports:
            - "${REDIS_PORT}:6379"
        volumes:
            - redis-data:/data
        networks:
            - xrosstalk-net

    rabbitmq:
        image: rabbitmq:3-management
        ports:
            - "${RABBITMQ_PORT}:5672"
            - "15672:15672"
        volumes:
            - rabbitmq-data:/var/lib/rabbitmq
        networks:
            - xrosstalk-net

volumes:
    redis-data:
    rabbitmq-data:

networks:
    xrosstalk-net:
        driver: bridge
